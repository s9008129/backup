# 智能差異備份系統規格書 v2.0
## 非技術人員友善版 - 簡化設計

---

## 📋 專案概述

**專案名稱：** 簡易差異備份工具 (Simple Delta Backup Tool)  
**目標使用者：** 需要定期資料保護的個人/小型單位  
**平台：** Windows 11  
**設計理念：** 簡潔、安全、高效 - 一個畫面完成所有操作

---

## 🎯 核心功能

### 1️⃣ **手動備份（用戶主動控制）**
- 使用者設定「來源資料夾」（如：`C:\Documents\Important`）
- 使用者設定「目標外接式儲存裝置」及其內部的「目標資料夾」
- **操作方式：** 按一個按鈕「開始備份」→ 一鍵完成

### 2️⃣ **差異備份機制** (MUST - 核心優勢)
「**只備份有變化的檔案**」 — 聰明備份，快速完成

- **首次備份：** 備份所有檔案（完整備份）
- **後續備份（差異檢測方法）：**
  - 比對「修改時間戳」和「檔案大小」
  - ✅ 新增的檔案 → 複製
  - ✅ 修改過的檔案 → 更新
  - ⏭️ 未變化的檔案 → 自動跳過
  - 📝 已刪除的檔案 → 保留在備份中（歷史記錄）

**優勢：**
- 🚀 速度快 - 只處理變化檔案（典型備份 < 2分鐘）
- 💾 省空間 - 同一檔案只存一份（若無變化）
- 📅 1年保留 - 自動清理超過1年的舊版本

---

## 🔒 資安與穩定性設計

| 功能 | 實現方式 | 目的 |
|------|--------|------|
| **完整性驗證** | 複製後自動校驗檔案大小 | 確保備份無損 |
| **狀態追蹤** | 生成`.backup_manifest`元資料 | 下次只備份異動部分 |
| **外接裝置檢查** | 啟動備份時驗證連接 | 防止誤操作 |
| **自動建立目標** | 若資料夾不存在自動建立 | 簡化使用者操作 |
| **日誌記錄** | 記錄日期/異動數/錯誤 | 了解備份詳情 |
| **版本管理** | 自動刪除超過1年的備份 | 控制儲存空間 |
| **中斷恢復** | 下次備份自動續傳異動部分 | 網路不穩定時保護 |

---

## 💻 使用情境範例

### 情境：個人月度備份

```
上班族 王小姐
├─ 來源：C:\Users\WangXiao\Documents\
├─ 目標：外接硬碟(E:)\我的備份\Documents_Backup\
├─ 操作方式：手動備份（月初或重要時刻）
│
操作流程：
  1️⃣ 連接外接硬碟
  2️⃣ 打開備份工具
  3️⃣ 設定來源和目標
  4️⃣ 按【開始備份】
  5️⃣ 系統自動完成
  6️⃣ 看到結果：✅ 備份完成 (日期時間、異動檔案數、狀態)

首月（1月1日）：備份 500MB（首次，全部）
次月（2月1日）：備份 50MB（只有新增和修改的）
三月（3月1日）：備份 20MB（只有新增和修改的）

💾 總計外接硬碟使用：~570MB（而非1500MB×3次）
✅ 節省 ~62% 儲存空間
⚡ 每次備份耗時 < 2分鐘
```

---

## 🛠️ 系統設計概述

### 單一畫面 UI 設計（無scroll）

```
╔═══════════════════════════════════════════════╗
║         簡易差異備份工具 v1.0                 ║
╠═══════════════════════════════════════════════╣
║                                               ║
║  📁 設定                                      ║
║  ┌─────────────────────────────────────────┐ ║
║  │ 來源資料夾：C:\Users\Name\Documents\   │ ║
║  │ [瀏覽]                                  │ ║
║  └─────────────────────────────────────────┘ ║
║                                               ║
║  ┌─────────────────────────────────────────┐ ║
║  │ 目標位置：E:\Backup\Docs\              │ ║
║  │ [瀏覽]                                  │ ║
║  └─────────────────────────────────────────┘ ║
║                                               ║
║  🎯 操作                                      ║
║  [開始備份]  [恢復檔案]                       ║
║                                               ║
║  📋 最新結果                                  ║
║  ┌─────────────────────────────────────────┐ ║
║  │ 日期時間: 2026-01-29 14:30:45           │ ║
║  │ 異動檔案: 15 個                         │ ║
║  │ 狀態: ✅ 備份完成                        │ ║
║  │ 錯誤: 無                                 │ ║
║  └─────────────────────────────────────────┘ ║
║                                               ║
║  📜 備份歷史（最近5次）                       ║
║  ┌─────────────────────────────────────────┐ ║
║  │ 2026-01-29 14:30 | 15個 | ✅ 完成      │ ║
║  │ 2026-01-15 10:20 | 8個  | ✅ 完成      │ ║
║  │ 2025-12-20 09:15 | 102個 | ✅ 完成     │ ║
║  │ 2025-11-10 16:45 | 23個 | ✅ 完成      │ ║
║  │ 2025-10-01 11:30 | 450個 | ✅ 完成     │ ║
║  └─────────────────────────────────────────┘ ║
║                                               ║
╚═══════════════════════════════════════════════╝
```

### 核心工作流程

```
【使用者按「開始備份」】
       ↓
【檢查外接裝置是否連接】
  ❌ 未連接 → 顯示警告，停止
       ↓ ✅
【讀取上次備份狀態檔案(.backup_manifest)】
       ↓
【掃描來源資料夾 → 比對時間戳+大小】
       ↓
【識別差異檔案】
  • 新增檔案
  • 修改檔案
  • 已刪除檔案（記錄在備份中）
       ↓
【複製差異檔案到目標位置】
       ↓
【驗證複製完整性（檔案大小檢驗）】
  ❌ 失敗 → 記錄錯誤訊息
       ↓ ✅
【更新元資料檔案(.backup_manifest)】
       ↓
【清理超過1年的備份版本】
       ↓
【記錄日誌（日期、異動數、完成狀態）】
       ↓
【顯示完成結果 → 更新UI畫面】
```

---

## 📊 系統需求

| 項目 | 規格 |
|------|------|
| **作業系統** | Windows 11 |
| **程式大小** | < 50MB |
| **外接式儲存** | USB 2.0以上 |
| **權限需求** | 標準使用者（具資料夾存取權限） |
| **網路** | 不需要（完全離線操作） |
| **元資料檔案** | `.backup_manifest` (JSON格式) |

### 元資料檔案格式
```json
{
  "lastBackupTime": "2026-01-29T14:30:45Z",
  "sourceFolder": "C:\\Users\\Name\\Documents",
  "targetFolder": "E:\\Backup\\Docs",
  "filesCount": 15,
  "totalSize": 1234567,
  "filesList": [
    {
      "path": "file1.txt",
      "size": 1024,
      "modified": "2026-01-28T10:20:00Z"
    }
  ]
}
```

---

## ✅ 核心特性清單

- [x] **手動備份** - 使用者點擊按鈕，一鍵開始
- [x] **差異備份** - 只備份新增/修改的檔案
- [x] **單一畫面UI** - 無scroll，看得到所有功能
- [x] **完整性驗證** - 自動檢查備份是否完整
- [x] **3項日誌** - 日期時間、異動檔案數、錯誤訊息
- [x] **外接裝置檢查** - 確保裝置已連接
- [x] **自動建立目標** - 不存在時自動建立資料夾
- [x] **保留1年** - 自動刪除超過1年的備份
- [x] **簡易恢復** - 選資料夾→選檔案→復原
- [x] **狀態追蹤** - 元資料檔案記錄備份狀態

---

## 🔄 使用者備份流程

### 典型使用場景

```
【月初】
 1. 連接外接硬碟
 2. 打開備份工具
 3. 設定來源和目標
 4. 點【開始備份】
 5. ✅ 系統自動完成 + 顯示結果

【一個月後】
 1. 連接同一個外接硬碟
 2. 打開備份工具
 3. 系統自動讀取上次備份資訊
 4. 點【開始備份】
 5. ✅ 系統只備份異動檔案 + 顯示結果

【需要恢復檔案時】
 1. 連接備份硬碟
 2. 打開備份工具
 3. 點【恢復檔案】
 4. 選擇要恢復的資料夾
 5. 確認覆蓋選項
 6. ✅ 檔案恢復完成
```

---

## ✅ 驗收標準（簡化版）

1. **備份功能** - 首次完全備份、後續差異備份正常運作
2. **檔案驗證** - 每次備份檔案完整性檢驗成功
3. **日誌記錄** - 日期、異動數、錯誤訊息正確
4. **UI清晰** - 單一畫面無scroll，訊息明確
5. **恢復功能** - 可正確選擇和復原備份檔案
6. **錯誤處理** - 異常情況（裝置未連接、目標不存在）正確提示

---

## 🔍 邏輯檢查與改進項目

### 已解決的潛在盲點

| # | 潛在問題 | 解決方案 |
|----|---------|--------|
| 1 | 如何判定檔案變化？ | 使用修改時間+檔案大小（簡單可靠） |
| 2 | 外接裝置未連接？ | 啟動前檢查→提示「請連接裝置」 |
| 3 | 目標資料夾不存在？ | 自動建立（無需手動） |
| 4 | 備份中途中斷？ | 保存元資料→下次續傳 |
| 5 | 備份檔案衝突？ | 覆蓋較新版本（保留舊版本備份） |
| 6 | 如何追蹤異動？ | `.backup_manifest`元資料檔案 |
| 7 | 恢復時誤操作？ | 恢復前顯示預覽清單 |
| 8 | 儲存空間無限增長？ | 自動刪除超過1年的備份 |

---

## 🛠️ 開發環境 (v2.0 更新)

### 環境方案

本工具支援**兩種虛擬環境**方案：

#### 方案 A: Conda (如果已安裝)
- 優點：完全隔離、可復現
- 命令：`conda activate backup`

#### 方案 B: Python venv (推薦備選)
- 優點：無需額外安裝、輕量級
- 命令：`venv\Scripts\activate`

**本工具會自動偵測並選擇最佳方案！**

### 快速設定

```batch
cd D:\dev\backup
setup_v2.bat
```

耗時 3-5 分鐘，自動完成：
- ✅ 檢查 Python 和 Git
- ✅ 建立虛擬環境
- ✅ 安裝套件依賴
- ✅ 初始化 Git 倉庫

### 前置要求

| 項目 | 必須 | 說明 |
|------|------|------|
| Python 3.11+ | ✅ | 下載: https://www.python.org/downloads/ |
| Git | ✅ | 下載: https://git-scm.com/download/win |
| Conda | ⭕ | 可選 - 無則自動用 venv |

---

## 📅 開發計畫

- [x] **第1階段** - 基礎架構 (✅ 完成)
- [x] **第2階段** - 差異備份核心邏輯 (✅ 完成)
- [x] **第3階段** - 恢復功能 (✅ 完成)
- [x] **第4階段** - 測試與優化 (✅ 完成)
- [x] **第5階段** - 驗收與交付 (✅ 完成)

---

**文件版本：** 2.1 (環境方案優化版)  
**最後更新：** 2026-01-29  
**狀態：** ✅ 已完成，環境設定已優化
